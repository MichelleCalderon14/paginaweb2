{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../alumnos/alumnos.service\";\nimport * as i2 from \"../../shared/auth.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction DocenteCalificacionesPage_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6);\n    i0.ɵɵtext(1, \"Cargando alumnos\\u2026\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DocenteCalificacionesPage_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵtext(1, \"No se pudieron cargar los datos.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DocenteCalificacionesPage_ng_container_5_table_7_th_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const t_r3 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", t_r3, \" \");\n  }\n}\nfunction DocenteCalificacionesPage_ng_container_5_table_7_tr_11_td_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"td\")(1, \"input\", 17);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function DocenteCalificacionesPage_ng_container_5_table_7_tr_11_td_3_Template_input_ngModelChange_1_listener($event) {\n      const j_r5 = i0.ɵɵrestoreView(_r4).index;\n      const a_r6 = i0.ɵɵnextContext().$implicit;\n      i0.ɵɵtwoWayBindingSet(a_r6.notas[j_r5], $event) || (a_r6.notas[j_r5] = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"ngModelChange\", function DocenteCalificacionesPage_ng_container_5_table_7_tr_11_td_3_Template_input_ngModelChange_1_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const a_r6 = i0.ɵɵnextContext().$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.recalcular(a_r6));\n    });\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const j_r5 = ctx.index;\n    const a_r6 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", a_r6.notas[j_r5]);\n  }\n}\nfunction DocenteCalificacionesPage_ng_container_5_table_7_tr_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 15);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, DocenteCalificacionesPage_ng_container_5_table_7_tr_11_td_3_Template, 2, 1, \"td\", 14);\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\", 16);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const a_r6 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" \", a_r6.apellidos, \" \", a_r6.nombres, \" \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.tareas);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", a_r6.promedio !== null ? a_r6.promedio : \"\\u2014\", \" \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngClass\", a_r6.estado === \"Aprueba\" ? \"text-success fw-bold\" : a_r6.estado === \"Reprueba\" ? \"text-danger fw-bold\" : \"\");\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", a_r6.estado || \"\\u2014\", \" \");\n  }\n}\nfunction DocenteCalificacionesPage_ng_container_5_table_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 12)(1, \"thead\", 13)(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"Estudiante\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, DocenteCalificacionesPage_ng_container_5_table_7_th_5_Template, 2, 1, \"th\", 14);\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Promedio\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Estado\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(10, \"tbody\");\n    i0.ɵɵtemplate(11, DocenteCalificacionesPage_ng_container_5_table_7_tr_11_Template, 8, 6, \"tr\", 14);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.tareas);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.alumnos);\n  }\n}\nfunction DocenteCalificacionesPage_ng_container_5_ng_template_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 18);\n    i0.ɵɵtext(1, \" No hay alumnos registrados para este docente. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DocenteCalificacionesPage_ng_container_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 8)(2, \"div\")(3, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function DocenteCalificacionesPage_ng_container_5_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.agregarTarea());\n    });\n    i0.ɵɵtext(4, \" Crear nueva tarea \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"small\", 10);\n    i0.ɵɵtext(6, \" Por defecto tienes Tarea 1 y Tarea 2; puedes a\\u00F1adir m\\u00E1s tareas con el bot\\u00F3n. \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(7, DocenteCalificacionesPage_ng_container_5_table_7_Template, 12, 2, \"table\", 11)(8, DocenteCalificacionesPage_ng_container_5_ng_template_8_Template, 2, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const sinAlumnos_r7 = i0.ɵɵreference(9);\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.alumnos.length)(\"ngIfElse\", sinAlumnos_r7);\n  }\n}\nexport let DocenteCalificacionesPage = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class DocenteCalificacionesPage {\n    constructor(alumnosSrv, auth) {\n      this.alumnosSrv = alumnosSrv;\n      this.auth = auth;\n      // columnas de tareas\n      this.tareas = ['Tarea 1', 'Tarea 2'];\n      // alumnos extendidos con notas/promedio/estado\n      this.alumnos = [];\n      this.cargando = false;\n      this.error = false;\n    }\n    ngOnInit() {\n      const idDocente = this.getDocenteId();\n      this.cargarAlumnos(idDocente);\n    }\n    /** Igual que antes: mapear usuario → id_docente */\n    getDocenteId() {\n      const usuario = this.auth.currentUser;\n      const userName = usuario?.username?.toLowerCase() || '';\n      if (userName === 'mariacabrera') return 1;\n      if (userName === 'carlos molina') return 2;\n      if (userName === 'luispacheco') return 3;\n      console.warn('getDocenteId: usuario no mapeado, usando 1 por defecto');\n      return 1;\n    }\n    /** Carga solo los alumnos del docente y prepara las notas en blanco */\n    cargarAlumnos(idDocente) {\n      this.cargando = true;\n      this.error = false;\n      this.alumnosSrv.listarPorDocente(idDocente).subscribe({\n        next: lista => {\n          const baseNotas = this.tareas.map(() => null);\n          this.alumnos = (lista || []).map(a => ({\n            ...a,\n            notas: [...baseNotas],\n            // copia para cada alumno\n            promedio: null,\n            estado: ''\n          }));\n          this.cargando = false;\n        },\n        error: err => {\n          console.error('[DocenteCalificaciones] error cargando alumnos', err);\n          this.error = true;\n          this.cargando = false;\n        }\n      });\n    }\n    /** Agrega una nueva tarea (columna) para todos los alumnos */\n    agregarTarea() {\n      const num = this.tareas.length + 1;\n      const nombre = `Tarea ${num}`;\n      this.tareas.push(nombre);\n      // a cada alumno le agregamos una nota nueva (vacía) y recalculamos\n      this.alumnos.forEach(a => {\n        a.notas.push(null);\n        this.recalcular(a);\n      });\n    }\n    /** Recalcula promedio y estado de un alumno */\n    recalcular(a) {\n      const valores = a.notas.filter(v => v !== null && v !== undefined);\n      if (!valores.length) {\n        a.promedio = null;\n        a.estado = '';\n        return;\n      }\n      const suma = valores.reduce((acc, v) => acc + Number(v), 0);\n      const prom = suma / valores.length;\n      a.promedio = Number(prom.toFixed(2));\n      a.estado = prom >= 7 ? 'Aprueba' : 'Reprueba';\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function DocenteCalificacionesPage_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || DocenteCalificacionesPage)(i0.ɵɵdirectiveInject(i1.AlumnosService), i0.ɵɵdirectiveInject(i2.AuthService));\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: DocenteCalificacionesPage,\n      selectors: [[\"app-docente-calificaciones\"]],\n      decls: 6,\n      vars: 3,\n      consts: [[\"sinAlumnos\", \"\"], [1, \"container\", \"mt-4\"], [1, \"mb-3\"], [\"class\", \"alert alert-info\", 4, \"ngIf\"], [\"class\", \"alert alert-danger\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"alert\", \"alert-info\"], [1, \"alert\", \"alert-danger\"], [1, \"d-flex\", \"justify-content-between\", \"align-items-center\", \"mb-3\"], [1, \"btn\", \"btn-sm\", \"btn-outline-primary\", 3, \"click\"], [1, \"text-muted\"], [\"class\", \"table table-bordered table-striped text-center\", 4, \"ngIf\", \"ngIfElse\"], [1, \"table\", \"table-bordered\", \"table-striped\", \"text-center\"], [1, \"table-primary\"], [4, \"ngFor\", \"ngForOf\"], [1, \"text-start\"], [3, \"ngClass\"], [\"type\", \"number\", \"min\", \"0\", \"max\", \"10\", \"step\", \"0.1\", 1, \"form-control\", \"form-control-sm\", 3, \"ngModelChange\", \"ngModel\"], [1, \"alert\", \"alert-warning\"]],\n      template: function DocenteCalificacionesPage_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 1)(1, \"h2\", 2);\n          i0.ɵɵtext(2, \"Registro de Calificaciones\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(3, DocenteCalificacionesPage_div_3_Template, 2, 0, \"div\", 3)(4, DocenteCalificacionesPage_div_4_Template, 2, 0, \"div\", 4)(5, DocenteCalificacionesPage_ng_container_5_Template, 10, 2, \"ng-container\", 5);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", ctx.cargando);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.error);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", !ctx.cargando && !ctx.error);\n        }\n      },\n      dependencies: [CommonModule, i3.NgClass, i3.NgForOf, i3.NgIf, FormsModule, i4.DefaultValueAccessor, i4.NumberValueAccessor, i4.NgControlStatus, i4.MinValidator, i4.MaxValidator, i4.NgModel],\n      encapsulation: 2\n    }));\n  }\n  _staticBlock();\n  return DocenteCalificacionesPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}