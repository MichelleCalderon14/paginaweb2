{"ast":null,"code":"import { environment } from '../../environments/environment';\nimport { of } from 'rxjs';\nimport { map, timeout, catchError } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let AuthService = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class AuthService {\n    constructor(http) {\n      this.http = http;\n      this.KEY = 'app.auth.user';\n      this.base = `${environment.apiBase}/usuarios`;\n    }\n    // ====== SesiÃ³n actual en localStorage ======\n    get currentUser() {\n      const raw = localStorage.getItem(this.KEY);\n      return raw ? JSON.parse(raw) : null;\n    }\n    setSession(u) {\n      if (u) localStorage.setItem(this.KEY, JSON.stringify(u));else localStorage.removeItem(this.KEY);\n    }\n    isLoggedIn() {\n      return !!this.currentUser;\n    }\n    logout() {\n      localStorage.removeItem(this.KEY);\n    }\n    // ====== Roles ======\n    hasRole(role) {\n      const u = this.currentUser;\n      return !!u && u.rol?.nombre === role;\n    }\n    // Helpers cÃ³modos para guards / componentes\n    isAdmin() {\n      return this.hasRole('ADMIN');\n    }\n    isDocente() {\n      return this.hasRole('DOCENTE');\n    }\n    isAlumno() {\n      return this.hasRole('ALUMNO');\n    }\n    // ====== Login ======\n    login(username, password) {\n      const u = (username || '').trim();\n      const p = (password || '').trim();\n      if (!u || !p) return of(null);\n      // ðŸ”¹ MODO FAKE (desarrollo, sin tocar tu API)\n      if (environment.useFakeAuth) {\n        const FAKE_USERS = [\n        // Admin\n        {\n          username: 'admin',\n          password: 'admin',\n          rol: 'ADMIN',\n          id: 1,\n          email: 'admin@colegio.local'\n        },\n        // Docentes\n        {\n          username: 'carlosmolina',\n          password: 'carlosmolina',\n          rol: 'DOCENTE',\n          id: 2,\n          email: 'carlos@colegio.local'\n        }, {\n          username: 'mariacabrera',\n          password: 'mariacabrera',\n          rol: 'DOCENTE',\n          id: 3,\n          email: 'maria@colegio.local'\n        }, {\n          username: 'luispacheco',\n          password: 'luispacheco',\n          rol: 'DOCENTE',\n          id: 4,\n          email: 'luispacheco@colegio.local'\n        },\n        // Alumnos (los que verÃ¡n solo sus notas)\n        {\n          username: 'pepecabrera',\n          password: 'pepecabrera',\n          rol: 'ALUMNO',\n          id: 10,\n          email: 'pepe@colegio.local'\n        }, {\n          username: 'sofiagarcia',\n          password: 'sofiagarcia',\n          rol: 'ALUMNO',\n          id: 11,\n          email: 'sofia@colegio.local'\n        }, {\n          username: 'mateolopez',\n          password: 'mateolopez',\n          rol: 'ALUMNO',\n          id: 12,\n          email: 'mateo@colegio.local'\n        }, {\n          username: 'valentinaperez',\n          password: 'valentinaperez',\n          rol: 'ALUMNO',\n          id: 13,\n          email: 'valentina@colegio.local'\n        }, {\n          username: 'sebastiantorres',\n          password: 'sebastiantorres',\n          rol: 'ALUMNO',\n          id: 14,\n          email: 'sebastian@colegio.local'\n        }, {\n          username: 'camilarojas',\n          password: 'camilarojas',\n          rol: 'ALUMNO',\n          id: 15,\n          email: 'camila@colegio.local'\n        }, {\n          username: 'janettarmijos',\n          password: 'janettarmijos',\n          rol: 'ALUMNO',\n          id: 16,\n          email: 'janett@colegio.local'\n        }];\n        // ðŸ”§ normalizamos: sin mayÃºsculas y sin espacios internos\n        const norm = s => s.toLowerCase().replace(/\\s+/g, '');\n        const f = FAKE_USERS.find(x => norm(x.username) === norm(username) && x.password === password);\n        if (f) {\n          const usuario = {\n            id_usuario: f.id,\n            username: f.username,\n            email: f.email || null,\n            activo: true,\n            rol: {\n              id_rol: f.rol === 'ADMIN' ? 1 : f.rol === 'DOCENTE' ? 2 : 3,\n              nombre: f.rol\n            }\n          };\n          this.setSession(usuario);\n          return of(usuario);\n        }\n        return of(null);\n      }\n      // ðŸ”¹ MODO REAL (cuando uses tu API)\n      const url = `${this.base}?_=${Date.now()}`;\n      return this.http.get(url).pipe(timeout(8000), map(users => {\n        const found = (users || []).find(x => x.username?.toLowerCase() === u.toLowerCase() && x.passwordHash === p && x.activo === true);\n        if (found) this.setSession(found);\n        return found || null;\n      }), catchError(() => of(null)));\n    }\n    static #_ = _staticBlock = () => (this.Éµfac = function AuthService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AuthService)(i0.ÉµÉµinject(i1.HttpClient));\n    }, this.Éµprov = /*@__PURE__*/i0.ÉµÉµdefineInjectable({\n      token: AuthService,\n      factory: AuthService.Éµfac,\n      providedIn: 'root'\n    }));\n  }\n  _staticBlock();\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}