{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../alumnos/alumnos.service\";\nimport * as i2 from \"../../shared/auth.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction DocenteCalificacionesPage_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\", 6);\n    i0.ÉµÉµtext(1, \"Cargando alumnos\\u2026\");\n    i0.ÉµÉµelementEnd();\n  }\n}\nfunction DocenteCalificacionesPage_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\", 7);\n    i0.ÉµÉµtext(1, \"No se pudieron cargar los datos.\");\n    i0.ÉµÉµelementEnd();\n  }\n}\nfunction DocenteCalificacionesPage_ng_container_5_table_9_th_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"th\");\n    i0.ÉµÉµtext(1);\n    i0.ÉµÉµelementEnd();\n  }\n  if (rf & 2) {\n    const t_r3 = ctx.$implicit;\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµtextInterpolate(t_r3);\n  }\n}\nfunction DocenteCalificacionesPage_ng_container_5_table_9_tr_11_td_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"td\")(1, \"input\", 19);\n    i0.ÉµÉµtwoWayListener(\"ngModelChange\", function DocenteCalificacionesPage_ng_container_5_table_9_tr_11_td_3_Template_input_ngModelChange_1_listener($event) {\n      const j_r5 = i0.ÉµÉµrestoreView(_r4).index;\n      const a_r6 = i0.ÉµÉµnextContext().$implicit;\n      i0.ÉµÉµtwoWayBindingSet(a_r6.notas[j_r5], $event) || (a_r6.notas[j_r5] = $event);\n      return i0.ÉµÉµresetView($event);\n    });\n    i0.ÉµÉµlistener(\"ngModelChange\", function DocenteCalificacionesPage_ng_container_5_table_9_tr_11_td_3_Template_input_ngModelChange_1_listener() {\n      i0.ÉµÉµrestoreView(_r4);\n      const a_r6 = i0.ÉµÉµnextContext().$implicit;\n      const ctx_r1 = i0.ÉµÉµnextContext(3);\n      return i0.ÉµÉµresetView(ctx_r1.recalcular(a_r6));\n    });\n    i0.ÉµÉµelementEnd()();\n  }\n  if (rf & 2) {\n    const j_r5 = ctx.index;\n    const a_r6 = i0.ÉµÉµnextContext().$implicit;\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµtwoWayProperty(\"ngModel\", a_r6.notas[j_r5]);\n  }\n}\nfunction DocenteCalificacionesPage_ng_container_5_table_9_tr_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"tr\")(1, \"td\", 17);\n    i0.ÉµÉµtext(2);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtemplate(3, DocenteCalificacionesPage_ng_container_5_table_9_tr_11_td_3_Template, 2, 1, \"td\", 16);\n    i0.ÉµÉµelementStart(4, \"td\");\n    i0.ÉµÉµtext(5);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(6, \"td\", 18);\n    i0.ÉµÉµtext(7);\n    i0.ÉµÉµelementEnd()();\n  }\n  if (rf & 2) {\n    const a_r6 = ctx.$implicit;\n    const ctx_r1 = i0.ÉµÉµnextContext(3);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate2(\" \", a_r6.apellidos, \" \", a_r6.nombres, \" \");\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµproperty(\"ngForOf\", ctx_r1.tareas);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate1(\" \", a_r6.promedio !== null ? a_r6.promedio : \"\\u2014\", \" \");\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµproperty(\"ngClass\", a_r6.estado === \"Aprueba\" ? \"text-success fw-bold\" : a_r6.estado === \"Reprueba\" ? \"text-danger fw-bold\" : \"\");\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµtextInterpolate1(\" \", a_r6.estado || \"\\u2014\", \" \");\n  }\n}\nfunction DocenteCalificacionesPage_ng_container_5_table_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"table\", 14)(1, \"thead\", 15)(2, \"tr\")(3, \"th\");\n    i0.ÉµÉµtext(4, \"Estudiante\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtemplate(5, DocenteCalificacionesPage_ng_container_5_table_9_th_5_Template, 2, 1, \"th\", 16);\n    i0.ÉµÉµelementStart(6, \"th\");\n    i0.ÉµÉµtext(7, \"Promedio\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(8, \"th\");\n    i0.ÉµÉµtext(9, \"Estado\");\n    i0.ÉµÉµelementEnd()()();\n    i0.ÉµÉµelementStart(10, \"tbody\");\n    i0.ÉµÉµtemplate(11, DocenteCalificacionesPage_ng_container_5_table_9_tr_11_Template, 8, 6, \"tr\", 16);\n    i0.ÉµÉµelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ÉµÉµnextContext(2);\n    i0.ÉµÉµadvance(5);\n    i0.ÉµÉµproperty(\"ngForOf\", ctx_r1.tareas);\n    i0.ÉµÉµadvance(6);\n    i0.ÉµÉµproperty(\"ngForOf\", ctx_r1.alumnos);\n  }\n}\nfunction DocenteCalificacionesPage_ng_container_5_ng_template_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\", 20);\n    i0.ÉµÉµtext(1, \" No hay alumnos registrados para este docente. \");\n    i0.ÉµÉµelementEnd();\n  }\n}\nfunction DocenteCalificacionesPage_ng_container_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementContainerStart(0);\n    i0.ÉµÉµelementStart(1, \"div\", 8)(2, \"div\", 9)(3, \"button\", 10);\n    i0.ÉµÉµlistener(\"click\", function DocenteCalificacionesPage_ng_container_5_Template_button_click_3_listener() {\n      i0.ÉµÉµrestoreView(_r1);\n      const ctx_r1 = i0.ÉµÉµnextContext();\n      return i0.ÉµÉµresetView(ctx_r1.agregarTarea());\n    });\n    i0.ÉµÉµtext(4, \" Crear nueva tarea \");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(5, \"button\", 11);\n    i0.ÉµÉµlistener(\"click\", function DocenteCalificacionesPage_ng_container_5_Template_button_click_5_listener() {\n      i0.ÉµÉµrestoreView(_r1);\n      const ctx_r1 = i0.ÉµÉµnextContext();\n      return i0.ÉµÉµresetView(ctx_r1.guardarCalificaciones());\n    });\n    i0.ÉµÉµtext(6, \" Guardar cambios \");\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(7, \"small\", 12);\n    i0.ÉµÉµtext(8, \" Por defecto tienes Tarea 1 y Tarea 2; puedes a\\u00F1adir m\\u00E1s tareas con el bot\\u00F3n. \");\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµtemplate(9, DocenteCalificacionesPage_ng_container_5_table_9_Template, 12, 2, \"table\", 13)(10, DocenteCalificacionesPage_ng_container_5_ng_template_10_Template, 2, 0, \"ng-template\", null, 0, i0.ÉµÉµtemplateRefExtractor);\n    i0.ÉµÉµelementContainerEnd();\n  }\n  if (rf & 2) {\n    const sinAlumnos_r7 = i0.ÉµÉµreference(11);\n    const ctx_r1 = i0.ÉµÉµnextContext();\n    i0.ÉµÉµadvance(9);\n    i0.ÉµÉµproperty(\"ngIf\", ctx_r1.alumnos.length)(\"ngIfElse\", sinAlumnos_r7);\n  }\n}\nconst STORAGE_PREFIX = 'colegio.calificaciones.docente.';\nexport let DocenteCalificacionesPage = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class DocenteCalificacionesPage {\n    constructor(alumnosSrv, auth) {\n      this.alumnosSrv = alumnosSrv;\n      this.auth = auth;\n      this.tareas = ['Tarea 1', 'Tarea 2'];\n      this.alumnos = [];\n      this.cargando = false;\n      this.error = false;\n    }\n    ngOnInit() {\n      this.idDocente = this.getDocenteId();\n      this.cargarAlumnos(this.idDocente);\n    }\n    getDocenteId() {\n      const usuario = this.auth.currentUser;\n      const userName = usuario?.username?.toLowerCase() || '';\n      if (userName === 'mariacabrera') return 1;\n      if (userName === 'carlos molina') return 2;\n      if (userName === 'luispacheco') return 3;\n      console.warn('getDocenteId: usuario no mapeado, usando 1 por defecto');\n      return 1;\n    }\n    storageKey(idDocente) {\n      return `${STORAGE_PREFIX}${idDocente}`;\n    }\n    cargarAlumnos(idDocente) {\n      this.cargando = true;\n      this.error = false;\n      this.alumnosSrv.listarPorDocente(idDocente).subscribe({\n        next: lista => {\n          const baseNotas = this.tareas.map(() => null);\n          this.alumnos = (lista || []).map(a => ({\n            ...a,\n            notas: [...baseNotas],\n            promedio: null,\n            estado: ''\n          }));\n          // ðŸ‘‡ despuÃ©s de tener los alumnos, aplicamos lo guardado\n          this.cargarDesdeStorage(idDocente);\n          this.cargando = false;\n        },\n        error: err => {\n          console.error('[DocenteCalificaciones] error cargando alumnos', err);\n          this.error = true;\n          this.cargando = false;\n        }\n      });\n    }\n    cargarDesdeStorage(idDocente) {\n      const raw = localStorage.getItem(this.storageKey(idDocente));\n      if (!raw) return;\n      try {\n        const data = JSON.parse(raw);\n        if (Array.isArray(data.tareas) && data.tareas.length) {\n          this.tareas = [...data.tareas];\n        }\n        if (Array.isArray(data.alumnos)) {\n          this.alumnos.forEach(a => {\n            const guardado = data.alumnos.find(x => x.id_alumno === a.id_alumno);\n            if (guardado) {\n              a.notas = [...guardado.notas];\n              a.promedio = guardado.promedio ?? null;\n              a.estado = guardado.estado ?? '';\n            }\n          });\n        }\n      } catch (e) {\n        console.error('Error leyendo calificaciones desde storage', e);\n      }\n    }\n    agregarTarea() {\n      const num = this.tareas.length + 1;\n      const nombre = `Tarea ${num}`;\n      this.tareas.push(nombre);\n      this.alumnos.forEach(a => {\n        a.notas.push(null);\n        this.recalcular(a);\n      });\n    }\n    recalcular(a) {\n      const valores = a.notas.filter(v => v !== null && v !== undefined);\n      if (!valores.length) {\n        a.promedio = null;\n        a.estado = '';\n        return;\n      }\n      const suma = valores.reduce((acc, v) => acc + Number(v), 0);\n      const prom = suma / valores.length;\n      a.promedio = Number(prom.toFixed(2));\n      a.estado = prom >= 7 ? 'Aprueba' : 'Reprueba';\n    }\n    guardarCalificaciones() {\n      const payload = {\n        tareas: [...this.tareas],\n        alumnos: this.alumnos.map(a => ({\n          id_alumno: a.id_alumno,\n          nombre: `${a.apellidos} ${a.nombres}`,\n          notas: [...a.notas],\n          promedio: a.promedio,\n          estado: a.estado\n        }))\n      };\n      localStorage.setItem(this.storageKey(this.idDocente), JSON.stringify(payload));\n      alert('Calificaciones guardadas en este equipo âœ”');\n    }\n    static #_ = _staticBlock = () => (this.Éµfac = function DocenteCalificacionesPage_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || DocenteCalificacionesPage)(i0.ÉµÉµdirectiveInject(i1.AlumnosService), i0.ÉµÉµdirectiveInject(i2.AuthService));\n    }, this.Éµcmp = /*@__PURE__*/i0.ÉµÉµdefineComponent({\n      type: DocenteCalificacionesPage,\n      selectors: [[\"app-docente-calificaciones\"]],\n      decls: 6,\n      vars: 3,\n      consts: [[\"sinAlumnos\", \"\"], [1, \"container\", \"mt-4\"], [1, \"mb-3\"], [\"class\", \"alert alert-info\", 4, \"ngIf\"], [\"class\", \"alert alert-danger\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"alert\", \"alert-info\"], [1, \"alert\", \"alert-danger\"], [1, \"d-flex\", \"justify-content-between\", \"align-items-center\", \"mb-3\"], [1, \"btn-group\", \"btn-group-sm\"], [1, \"btn\", \"btn-outline-primary\", 3, \"click\"], [1, \"btn\", \"btn-success\", 3, \"click\"], [1, \"text-muted\"], [\"class\", \"table table-bordered table-striped text-center\", 4, \"ngIf\", \"ngIfElse\"], [1, \"table\", \"table-bordered\", \"table-striped\", \"text-center\"], [1, \"table-primary\"], [4, \"ngFor\", \"ngForOf\"], [1, \"text-start\"], [3, \"ngClass\"], [\"type\", \"number\", \"min\", \"0\", \"max\", \"10\", \"step\", \"0.1\", 1, \"form-control\", \"form-control-sm\", 3, \"ngModelChange\", \"ngModel\"], [1, \"alert\", \"alert-warning\"]],\n      template: function DocenteCalificacionesPage_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ÉµÉµelementStart(0, \"div\", 1)(1, \"h2\", 2);\n          i0.ÉµÉµtext(2, \"Registro de Calificaciones\");\n          i0.ÉµÉµelementEnd();\n          i0.ÉµÉµtemplate(3, DocenteCalificacionesPage_div_3_Template, 2, 0, \"div\", 3)(4, DocenteCalificacionesPage_div_4_Template, 2, 0, \"div\", 4)(5, DocenteCalificacionesPage_ng_container_5_Template, 12, 2, \"ng-container\", 5);\n          i0.ÉµÉµelementEnd();\n        }\n        if (rf & 2) {\n          i0.ÉµÉµadvance(3);\n          i0.ÉµÉµproperty(\"ngIf\", ctx.cargando);\n          i0.ÉµÉµadvance();\n          i0.ÉµÉµproperty(\"ngIf\", ctx.error);\n          i0.ÉµÉµadvance();\n          i0.ÉµÉµproperty(\"ngIf\", !ctx.cargando && !ctx.error);\n        }\n      },\n      dependencies: [CommonModule, i3.NgClass, i3.NgForOf, i3.NgIf, FormsModule, i4.DefaultValueAccessor, i4.NumberValueAccessor, i4.NgControlStatus, i4.MinValidator, i4.MaxValidator, i4.NgModel],\n      encapsulation: 2\n    }));\n  }\n  _staticBlock();\n  return DocenteCalificacionesPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}